const express = require('express');
const router = express.Router();
const axios = require('axios');

// Language mappings for better support
const LANGUAGE_CODES = {
    'twi': 'tw',
    'akan': 'ak',
    'yoruba': 'yo',
    'hausa': 'ha',
    'igbo': 'ig',
    'english': 'en',
    'french': 'fr',
    'spanish': 'es',
    'arabic': 'ar',
    'swahili': 'sw',
    'amharic': 'am',
    'portuguese': 'pt',
    'mandarin': 'zh',
    'hindi': 'hi',
    'urdu': 'ur',
    'fulani': 'ff',
    'kanuri': 'kr',
    'tiv': 'tiv',
    'edo': 'bin',
    'efik': 'efi',
    'zulu': 'zu'
};

// Custom translation dictionaries for African languages
const CUSTOM_TRANSLATIONS = {
    'twi_to_yoruba': {
        'akwaaba': 'kaabo',
        'medaase': 'e se',
        'aane': 'beni',
        'daabi': 'rara',
        'me din de': 'oruko mi ni',
        'wo ho te sen': 'bawo ni',
        'me pe wo': 'mo feran re',
        'nante yiye': 'o dabo',
        'ɛyɛ': 'o dara',
        'mepaakyɛw': 'je ka lo'
    },
    'yoruba_to_twi': {
        'kaabo': 'akwaaba',
        'e se': 'medaase',
        'beni': 'aane',
        'rara': 'daabi',
        'oruko mi ni': 'me din de',
        'bawo ni': 'wo ho te sen',
        'mo feran re': 'me pe wo',
        'o dabo': 'nante yiye',
        'o dara': 'ɛyɛ',
        'je ka lo': 'mepaakyɛw'
    },
    // Swahili translations (Tanzania, Kenya)
    'english_to_swahili': {
        'hello': 'hujambo',
        'goodbye': 'kwaheri',
        'thank you': 'asante',
        'please': 'tafadhali',
        'yes': 'ndio',
        'no': 'hapana',
        'good': 'nzuri',
        'how are you': 'habari yako',
        'how are you today': 'habari yako leo',
        'i love you': 'nakupenda',
        'have a good day': 'uwe na siku njema',
        'see you later': 'tutaonana baadaye',
        'what is your name': 'jina lako ni nani',
        'my name is': 'jina langu ni',
        'welcome': 'karibu',
        'friend': 'rafiki',
        'family': 'familia',
        'love': 'upendo',
        'peace': 'amani',
        'water': 'maji',
        'food': 'chakula'
    },
    'swahili_to_english': {
        'hujambo': 'hello',
        'kwaheri': 'goodbye',
        'asante': 'thank you',
        'tafadhali': 'please',
        'ndio': 'yes',
        'hapana': 'no',
        'nzuri': 'good',
        'habari yako': 'how are you',
        'habari yako leo': 'how are you today',
        'nakupenda': 'i love you',
        'uwe na siku njema': 'have a good day',
        'tutaonana baadaye': 'see you later',
        'jina lako ni nani': 'what is your name',
        'jina langu ni': 'my name is',
        'karibu': 'welcome',
        'rafiki': 'friend',
        'familia': 'family',
        'upendo': 'love',
        'amani': 'peace',
        'maji': 'water',
        'chakula': 'food'
    },
    // Zulu translations
    'english_to_zulu': {
        'hello': 'sawubona',
        'goodbye': 'sala kahle',
        'thank you': 'ngiyabonga',
        'please': 'ngicela',
        'yes': 'yebo',
        'no': 'cha',
        'good': 'okuhle',
        'how are you': 'unjani',
        'welcome': 'siyakwamukela',
        'friend': 'umngane',
        'family': 'umndeni',
        'love': 'uthando',
        'peace': 'ukuthula',
        'water': 'amanzi',
        'food': 'ukudla'
    },
    'zulu_to_english': {
        'sawubona': 'hello',
        'sala kahle': 'goodbye',
        'ngiyabonga': 'thank you',
        'ngicela': 'please',
        'yebo': 'yes',
        'cha': 'no',
        'okuhle': 'good',
        'unjani': 'how are you',
        'siyakwamukela': 'welcome',
        'umngane': 'friend',
        'umndeni': 'family',
        'uthando': 'love',
        'ukuthula': 'peace',
        'amanzi': 'water',
        'ukudla': 'food'
    },
    // Amharic translations (basic transliterations)
    'english_to_amharic': {
        'hello': 'selam',
        'goodbye': 'dehna hun',
        'thank you': 'ameseginalehu',
        'please': 'ebakish',
        'yes': 'awo',
        'no': 'alelem',
        'good': 'tiru',
        'how are you': 'dehneh neh',
        'welcome': 'enquan dehna metash',
        'friend': 'guadegna',
        'family': 'beteseb',
        'love': 'fikir',
        'peace': 'selam',
        'water': 'wuha',
        'food': 'migib'
    },
    'amharic_to_english': {
        'selam': 'hello',
        'dehna hun': 'goodbye',
        'ameseginalehu': 'thank you',
        'ebakish': 'please',
        'awo': 'yes',
        'alelem': 'no',
        'tiru': 'good',
        'dehneh neh': 'how are you',
        'enquan dehna metash': 'welcome',
        'guadegna': 'friend',
        'beteseb': 'family',
        'fikir': 'love',
        'wuha': 'water',
        'migib': 'food'
    },
    // Luganda translations (Uganda)
    'english_to_luganda': {
        'hello': 'ki kati',
        'goodbye': 'tulabagane',
        'thank you': 'webale',
        'please': 'nsaba',
        'yes': 'ye',
        'no': 'nedda',
        'good': 'kirungi',
        'how are you': 'oli otya',
        'welcome': 'tukusanyuse',
        'friend': 'mukwano',
        'family': 'famire',
        'love': 'okwagala',
        'peace': 'emirembe',
        'water': 'amazzi',
        'food': 'emmere'
    },
    'luganda_to_english': {
        'ki kati': 'hello',
        'tulabagane': 'goodbye',
        'webale': 'thank you',
        'nsaba': 'please',
        'ye': 'yes',
        'nedda': 'no',
        'kirungi': 'good',
        'oli otya': 'how are you',
        'tukusanyuse': 'welcome',
        'mukwano': 'friend',
        'famire': 'family',
        'okwagala': 'love',
        'emirembe': 'peace',
        'amazzi': 'water',
        'emmere': 'food'
    },
    // Bambara translations (Mali)
    'english_to_bambara': {
        'hello': 'i ni ce',
        'goodbye': 'kan ben',
        'thank you': 'i ni ce kosebe',
        'please': 'sabali',
        'yes': 'awon',
        'no': 'ayi',
        'good': 'ka nyi',
        'how are you': 'i ka kene wa',
        'welcome': 'bisimila',
        'friend': 'teri',
        'family': 'somogo',
        'love': 'kanu',
        'peace': 'heri',
        'water': 'ji',
        'food': 'dumuni'
    },
    'bambara_to_english': {
        'i ni ce': 'hello',
        'kan ben': 'goodbye',
        'i ni ce kosebe': 'thank you',
        'sabali': 'please',
        'awon': 'yes',
        'ayi': 'no',
        'ka nyi': 'good',
        'i ka kene wa': 'how are you',
        'bisimila': 'welcome',
        'teri': 'friend',
        'somogo': 'family',
        'kanu': 'love',
        'heri': 'peace',
        'ji': 'water',
        'dumuni': 'food'
    },
    // Yoruba translations (Nigeria) - COMPREHENSIVE
    'english_to_yoruba': {
        'hello': 'kaabo',
        'hi': 'bawo',
        'goodbye': 'o dabo',
        'bye': 'o dabo',
        'thank you': 'e se',
        'thanks': 'e se',
        'please': 'je ka lo',
        'yes': 'beni',
        'no': 'rara',
        'good': 'o dara',
        'bad': 'buburu',
        'how are you': 'bawo ni',
        'where': 'nibo',
        'when': 'nigbawo',
        'why': 'kilode',
        'what': 'kini',
        'who': 'tani',
        'how': 'bawo',
        'go': 'lo',
        'come': 'wa',
        'stop': 'duro',
        'wait': 'duro',
        'help': 'ran mi lowo',
        'sorry': 'pele',
        'excuse me': 'e ma binu',
        'welcome': 'kaabo',
        'friend': 'ore',
        'family': 'ebi',
        'mother': 'mama',
        'father': 'baba',
        'child': 'omo',
        'love': 'ife',
        'like': 'feran',
        'want': 'fe',
        'need': 'nilo',
        'have': 'ni',
        'get': 'gba',
        'give': 'fun',
        'take': 'gba',
        'see': 'ri',
        'look': 'wo',
        'hear': 'gbo',
        'speak': 'so',
        'eat': 'je',
        'drink': 'mu',
        'sleep': 'sun',
        'work': 'ise',
        'play': 'sere',
        'read': 'ka',
        'write': 'ko',
        'buy': 'ra',
        'sell': 'ta',
        'money': 'owo',
        'time': 'akoko',
        'day': 'ojo',
        'night': 'ale',
        'morning': 'owuro',
        'afternoon': 'osan',
        'evening': 'ale',
        'today': 'oni',
        'tomorrow': 'ola',
        'yesterday': 'ana',
        'now': 'bayi',
        'later': 'nigbamii',
        'here': 'nibi',
        'there': 'nibe',
        'home': 'ile',
        'house': 'ile',
        'school': 'ile iwe',
        'hospital': 'ile iwosan',
        'market': 'oja',
        'church': 'ile ijoba',
        'mosque': 'moti',
        'peace': 'alaafia',
        'water': 'omi',
        'food': 'onje',
        'rice': 'iresi',
        'bread': 'buredi',
        'meat': 'eran',
        'fish': 'eja',
        'car': 'oko',
        'bus': 'oko ero',
        'phone': 'foonu',
        'book': 'iwe',
        'pen': 'kalam',
        'big': 'nla',
        'small': 'kekere',
        'hot': 'gbona',
        'cold': 'tutu',
        'fast': 'yara',
        'slow': 'lafiaji',
        'happy': 'dun',
        'sad': 'banuje',
        'angry': 'binu',
        'tired': 'are',
        'hungry': 'ebi',
        'thirsty': 'ongbe',
        'sick': 'aisun',
        'fine': 'dada',
        'beautiful': 'lewa',
        'ugly': 'egan',
        'new': 'tuntun',
        'old': 'atijo',
        'young': 'odo',
        'man': 'okunrin',
        'woman': 'obinrin',
        'boy': 'omokunrin',
        'girl': 'omobinrin'
    },
    'yoruba_to_english': {
        'kaabo': 'hello',
        'bawo': 'hi',
        'o dabo': 'goodbye',
        'e se': 'thank you',
        'je ka lo': 'please',
        'beni': 'yes',
        'rara': 'no',
        'o dara': 'good',
        'buburu': 'bad',
        'bawo ni': 'how are you',
        'nibo': 'where',
        'nigbawo': 'when',
        'kilode': 'why',
        'kini': 'what',
        'tani': 'who',
        'lo': 'go',
        'wa': 'come',
        'duro': 'stop',
        'ran mi lowo': 'help',
        'pele': 'sorry',
        'e ma binu': 'excuse me',
        'ore': 'friend',
        'ebi': 'family',
        'mama': 'mother',
        'baba': 'father',
        'omo': 'child',
        'ife': 'love',
        'feran': 'like',
        'fe': 'want',
        'nilo': 'need',
        'ni': 'have',
        'gba': 'get',
        'fun': 'give',
        'ri': 'see',
        'wo': 'look',
        'gbo': 'hear',
        'so': 'speak',
        'je': 'eat',
        'mu': 'drink',
        'sun': 'sleep',
        'ise': 'work',
        'sere': 'play',
        'ka': 'read',
        'ko': 'write',
        'ra': 'buy',
        'ta': 'sell',
        'owo': 'money',
        'akoko': 'time',
        'ojo': 'day',
        'ale': 'night',
        'owuro': 'morning',
        'osan': 'afternoon',
        'oni': 'today',
        'ola': 'tomorrow',
        'ana': 'yesterday',
        'bayi': 'now',
        'nigbamii': 'later',
        'nibi': 'here',
        'nibe': 'there',
        'ile': 'home',
        'ile iwe': 'school',
        'ile iwosan': 'hospital',
        'oja': 'market',
        'ile ijoba': 'church',
        'moti': 'mosque',
        'alaafia': 'peace',
        'omi': 'water',
        'onje': 'food',
        'iresi': 'rice',
        'buredi': 'bread',
        'eran': 'meat',
        'eja': 'fish',
        'oko': 'car',
        'oko ero': 'bus',
        'foonu': 'phone',
        'iwe': 'book',
        'kalam': 'pen',
        'nla': 'big',
        'kekere': 'small',
        'gbona': 'hot',
        'tutu': 'cold',
        'yara': 'fast',
        'lafiaji': 'slow',
        'dun': 'happy',
        'banuje': 'sad',
        'binu': 'angry',
        'are': 'tired',
        'ongbe': 'thirsty',
        'aisun': 'sick',
        'dada': 'fine',
        'lewa': 'beautiful',
        'egan': 'ugly',
        'tuntun': 'new',
        'atijo': 'old',
        'odo': 'young',
        'okunrin': 'man',
        'obinrin': 'woman',
        'omokunrin': 'boy',
        'omobinrin': 'girl'
    },
    // Twi/Akan translations (Ghana) - COMPREHENSIVE DICTIONARY
    'english_to_twi': {
        'hello': 'akwaaba',
        'hi': 'maakye',
        'goodbye': 'nante yiye',
        'bye': 'nante yiye',
        'thank you': 'medaase',
        'thanks': 'medaase',
        'please': 'mepaakyɛw',
        'yes': 'aane',
        'no': 'daabi',
        'good': 'ɛyɛ',
        'bad': 'ɛnyɛ',
        'how are you': 'wo ho te sen',
        'where': 'ɛhe',
        'when': 'bere ben',
        'why': 'adɛn',
        'what': 'dɛn',
        'who': 'hena',
        'how': 'sɛn',
        'go': 'kɔ',
        'come': 'bra',
        'stop': 'gyae',
        'wait': 'twɛn',
        'help': 'boa me',
        'sorry': 'kafra',
        'excuse me': 'ma me kwan',
        'welcome': 'akwaaba',
        'friend': 'adamfo',
        'family': 'abusua',
        'mother': 'maame',
        'father': 'papa',
        'child': 'abofra',
        'love': 'ɔdɔ',
        'like': 'pɛ',
        'want': 'pɛ',
        'need': 'hia',
        'have': 'wɔ',
        'get': 'nya',
        'give': 'ma',
        'take': 'fa',
        'see': 'hu',
        'look': 'hwɛ',
        'hear': 'te',
        'speak': 'kasa',
        'eat': 'di',
        'drink': 'nom',
        'sleep': 'da',
        'work': 'yɛ adwuma',
        'play': 'di agoru',
        'read': 'kenkan',
        'write': 'kyerɛw',
        'buy': 'tɔ',
        'sell': 'tɔn',
        'money': 'sika',
        'time': 'bere',
        'day': 'da',
        'night': 'anadwo',
        'morning': 'anɔpa',
        'afternoon': 'awia',
        'evening': 'anwummere',
        'today': 'ɛnnɛ',
        'tomorrow': 'ɔkyena',
        'yesterday': 'nnera',
        'now': 'seesei',
        'later': 'akyiri yi',
        'here': 'ha',
        'there': 'hɔ',
        'home': 'fie',
        'house': 'fie',
        'school': 'sukuu',
        'hospital': 'ayaresabea',
        'market': 'dwa',
        'church': 'asɔre',
        'mosque': 'nkramofo asɔre',
        'peace': 'asomdwoe',
        'water': 'nsuo',
        'food': 'aduan',
        'rice': 'emo',
        'bread': 'paanoo',
        'meat': 'nam',
        'fish': 'apataa',
        'car': 'kar',
        'bus': 'bɔs',
        'phone': 'telefon',
        'book': 'nhoma',
        'pen': 'kyerɛwdua',
        'big': 'kɛse',
        'small': 'ketewa',
        'hot': 'hyew',
        'cold': 'nwo',
        'fast': 'ntɛm',
        'slow': 'nkakrankakra',
        'happy': 'ani gye',
        'sad': 'awerɛhow',
        'angry': 'abufuw',
        'tired': 'abrɛ',
        'hungry': 'ɛkɔm de',
        'thirsty': 'osukɔm de',
        'sick': 'yare',
        'fine': 'ɛyɛ',
        'beautiful': 'fɛ',
        'ugly': 'tan',
        'new': 'foforo',
        'old': 'dedaw',
        'young': 'mmabun',
        'man': 'barima',
        'woman': 'bea',
        'boy': 'abarimaa',
        'girl': 'abeawa'
    },
    'twi_to_english': {
        'akwaaba': 'hello',
        'maakye': 'hi',
        'nante yiye': 'goodbye',
        'medaase': 'thank you',
        'mepaakyɛw': 'please',
        'aane': 'yes',
        'daabi': 'no',
        'ɛyɛ': 'good',
        'ɛnyɛ': 'bad',
        'wo ho te sen': 'how are you',
        'ɛhe': 'where',
        'bere ben': 'when',
        'adɛn': 'why',
        'dɛn': 'what',
        'hena': 'who',
        'sɛn': 'how',
        'kɔ': 'go',
        'bra': 'come',
        'gyae': 'stop',
        'twɛn': 'wait',
        'boa me': 'help',
        'kafra': 'sorry',
        'ma me kwan': 'excuse me',
        'adamfo': 'friend',
        'abusua': 'family',
        'maame': 'mother',
        'papa': 'father',
        'abofra': 'child',
        'ɔdɔ': 'love',
        'pɛ': 'like',
        'hia': 'need',
        'wɔ': 'have',
        'nya': 'get',
        'ma': 'give',
        'fa': 'take',
        'hu': 'see',
        'hwɛ': 'look',
        'te': 'hear',
        'kasa': 'speak',
        'di': 'eat',
        'nom': 'drink',
        'da': 'sleep',
        'yɛ adwuma': 'work',
        'di agoru': 'play',
        'kenkan': 'read',
        'kyerɛw': 'write',
        'tɔ': 'buy',
        'tɔn': 'sell',
        'sika': 'money',
        'bere': 'time',
        'da': 'day',
        'anadwo': 'night',
        'anɔpa': 'morning',
        'awia': 'afternoon',
        'anwummere': 'evening',
        'ɛnnɛ': 'today',
        'ɔkyena': 'tomorrow',
        'nnera': 'yesterday',
        'seesei': 'now',
        'akyiri yi': 'later',
        'ha': 'here',
        'hɔ': 'there',
        'fie': 'home',
        'sukuu': 'school',
        'ayaresabea': 'hospital',
        'dwa': 'market',
        'asɔre': 'church',
        'nkramofo asɔre': 'mosque',
        'asomdwoe': 'peace',
        'nsuo': 'water',
        'aduan': 'food',
        'emo': 'rice',
        'paanoo': 'bread',
        'nam': 'meat',
        'apataa': 'fish',
        'kar': 'car',
        'bɔs': 'bus',
        'telefon': 'phone',
        'nhoma': 'book',
        'kyerɛwdua': 'pen',
        'kɛse': 'big',
        'ketewa': 'small',
        'hyew': 'hot',
        'nwo': 'cold',
        'ntɛm': 'fast',
        'nkakrankakra': 'slow',
        'ani gye': 'happy',
        'awerɛhow': 'sad',
        'abufuw': 'angry',
        'abrɛ': 'tired',
        'ɛkɔm de': 'hungry',
        'osukɔm de': 'thirsty',
        'yare': 'sick',
        'fɛ': 'beautiful',
        'tan': 'ugly',
        'foforo': 'new',
        'dedaw': 'old',
        'mmabun': 'young',
        'barima': 'man',
        'bea': 'woman',
        'abarimaa': 'boy',
        'abeawa': 'girl'
    },
    // Hausa translations (Nigeria, Niger) - COMPREHENSIVE DICTIONARY
    'english_to_hausa': {
        'hello': 'sannu',
        'hi': 'sannu dai',
        'goodbye': 'sai anjima',
        'bye': 'sai an jima',
        'thank you': 'na gode',
        'thanks': 'na gode',
        'please': 'don Allah',
        'yes': 'eh',
        'no': 'a\'a',
        'good': 'mai kyau',
        'bad': 'mugu',
        'how are you': 'yaya kake',
        'where': 'ina',
        'when': 'yaushe',
        'why': 'me yasa',
        'what': 'me',
        'who': 'wa',
        'how': 'yaya',
        'go': 'tafi',
        'come': 'zo',
        'stop': 'tsaya',
        'wait': 'jira',
        'help': 'taimaka',
        'sorry': 'yi hakuri',
        'excuse me': 'ka yafe ni',
        'welcome': 'maraba',
        'friend': 'aboki',
        'family': 'iyali',
        'mother': 'uwa',
        'father': 'uba',
        'child': 'yaro',
        'love': 'kauna',
        'like': 'so',
        'want': 'so',
        'need': 'bukatar',
        'have': 'da',
        'get': 'samu',
        'give': 'ba',
        'take': 'dauka',
        'see': 'gani',
        'look': 'duba',
        'hear': 'ji',
        'speak': 'yi magana',
        'eat': 'ci',
        'drink': 'sha',
        'sleep': 'kwana',
        'work': 'aiki',
        'play': 'wasa',
        'read': 'karanta',
        'write': 'rubuta',
        'buy': 'saya',
        'sell': 'sayar',
        'money': 'kudi',
        'time': 'lokaci',
        'day': 'rana',
        'night': 'dare',
        'morning': 'safiya',
        'afternoon': 'rana',
        'evening': 'yamma',
        'today': 'yau',
        'tomorrow': 'gobe',
        'yesterday': 'jiya',
        'now': 'yanzu',
        'later': 'daga baya',
        'here': 'nan',
        'there': 'can',
        'home': 'gida',
        'house': 'gida',
        'school': 'makaranta',
        'hospital': 'asibiti',
        'market': 'kasuwa',
        'church': 'coci',
        'mosque': 'masallaci',
        'peace': 'zaman lafiya',
        'water': 'ruwa',
        'food': 'abinci',
        'rice': 'shinkafa',
        'bread': 'gurasa',
        'meat': 'nama',
        'fish': 'kifi',
        'car': 'mota',
        'bus': 'bas',
        'phone': 'waya',
        'book': 'littafi',
        'pen': 'alkalami',
        'big': 'babba',
        'small': 'karami',
        'hot': 'zafi',
        'cold': 'sanyi',
        'fast': 'sauri',
        'slow': 'a hankali',
        'happy': 'farin ciki',
        'sad': 'bakin ciki',
        'angry': 'fushi',
        'tired': 'gajiya',
        'hungry': 'yunwa',
        'thirsty': 'kishirwa',
        'sick': 'rashin lafiya',
        'fine': 'lafiya',
        'beautiful': 'kyakkyawa',
        'ugly': 'mugu',
        'new': 'sabo',
        'old': 'tsoho',
        'young': 'matashi',
        'man': 'mutum',
        'woman': 'mace',
        'boy': 'yaro',
        'girl': 'yarinya'
    },
    'hausa_to_english': {
        'sannu': 'hello',
        'sannu dai': 'hi',
        'sai anjima': 'goodbye',
        'sai an jima': 'bye',
        'na gode': 'thank you',
        'don Allah': 'please',
        'eh': 'yes',
        'a\'a': 'no',
        'mai kyau': 'good',
        'mugu': 'bad',
        'yaya kake': 'how are you',
        'ina': 'where',
        'yaushe': 'when',
        'me yasa': 'why',
        'me': 'what',
        'wa': 'who',
        'yaya': 'how',
        'tafi': 'go',
        'zo': 'come',
        'tsaya': 'stop',
        'jira': 'wait',
        'taimaka': 'help',
        'yi hakuri': 'sorry',
        'ka yafe ni': 'excuse me',
        'maraba': 'welcome',
        'aboki': 'friend',
        'iyali': 'family',
        'uwa': 'mother',
        'uba': 'father',
        'yaro': 'child',
        'kauna': 'love',
        'so': 'like',
        'bukatar': 'need',
        'da': 'have',
        'samu': 'get',
        'ba': 'give',
        'dauka': 'take',
        'gani': 'see',
        'duba': 'look',
        'ji': 'hear',
        'yi magana': 'speak',
        'ci': 'eat',
        'sha': 'drink',
        'kwana': 'sleep',
        'aiki': 'work',
        'wasa': 'play',
        'karanta': 'read',
        'rubuta': 'write',
        'saya': 'buy',
        'sayar': 'sell',
        'kudi': 'money',
        'lokaci': 'time',
        'rana': 'day',
        'dare': 'night',
        'safiya': 'morning',
        'yamma': 'evening',
        'yau': 'today',
        'gobe': 'tomorrow',
        'jiya': 'yesterday',
        'yanzu': 'now',
        'daga baya': 'later',
        'nan': 'here',
        'can': 'there',
        'gida': 'home',
        'makaranta': 'school',
        'asibiti': 'hospital',
        'kasuwa': 'market',
        'coci': 'church',
        'masallaci': 'mosque',
        'zaman lafiya': 'peace',
        'ruwa': 'water',
        'abinci': 'food',
        'shinkafa': 'rice',
        'gurasa': 'bread',
        'nama': 'meat',
        'kifi': 'fish',
        'mota': 'car',
        'bas': 'bus',
        'waya': 'phone',
        'littafi': 'book',
        'alkalami': 'pen',
        'babba': 'big',
        'karami': 'small',
        'zafi': 'hot',
        'sanyi': 'cold',
        'sauri': 'fast',
        'a hankali': 'slow',
        'farin ciki': 'happy',
        'bakin ciki': 'sad',
        'fushi': 'angry',
        'gajiya': 'tired',
        'yunwa': 'hungry',
        'kishirwa': 'thirsty',
        'rashin lafiya': 'sick',
        'lafiya': 'fine',
        'kyakkyawa': 'beautiful',
        'sabo': 'new',
        'tsoho': 'old',
        'matashi': 'young',
        'mutum': 'man',
        'mace': 'woman',
        'yarinya': 'girl'
    },
    // Igbo translations (Nigeria) - COMPREHENSIVE DICTIONARY
    'english_to_igbo': {
        'hello': 'ndewo',
        'hi': 'ndewo',
        'goodbye': 'ka omesia',
        'bye': 'ka omesia',
        'thank you': 'dalu',
        'thanks': 'dalu',
        'please': 'biko',
        'yes': 'ee',
        'no': 'mba',
        'good': 'oma',
        'bad': 'ojoo',
        'how are you': 'kedu ka i mere',
        'where': 'olee',
        'when': 'mgbe',
        'why': 'gini mere',
        'what': 'gini',
        'who': 'onye',
        'how': 'kedu',
        'go': 'gaa',
        'come': 'bia',
        'stop': 'kwusi',
        'wait': 'chere',
        'help': 'nyere aka',
        'sorry': 'ndo',
        'excuse me': 'cherem',
        'welcome': 'nnoo',
        'friend': 'enyi',
        'family': 'ezina ulo',
        'mother': 'nne',
        'father': 'nna',
        'child': 'nwata',
        'love': 'ihunanya',
        'like': 'masiri',
        'want': 'choro',
        'need': 'kwesiri',
        'have': 'nwere',
        'get': 'nweta',
        'give': 'nye',
        'take': 'were',
        'see': 'hu',
        'look': 'lee',
        'hear': 'nu',
        'speak': 'kwuo',
        'eat': 'rie',
        'drink': 'nuo',
        'sleep': 'hie ura',
        'work': 'ruo oru',
        'play': 'gwuo egwu',
        'read': 'guo',
        'write': 'dee',
        'buy': 'zuo',
        'sell': 'ree',
        'money': 'ego',
        'time': 'oge',
        'day': 'ubochi',
        'night': 'abali',
        'morning': 'ututo',
        'afternoon': 'ehihie',
        'evening': 'mgbede',
        'today': 'taa',
        'tomorrow': 'echi',
        'yesterday': 'nynyahu',
        'now': 'ugbu a',
        'later': 'mgbe ozo',
        'here': 'ebe a',
        'there': 'ebe ahu',
        'home': 'ulo',
        'house': 'ulo',
        'school': 'ulo akwukwo',
        'hospital': 'ulo ogwu',
        'market': 'ahia',
        'church': 'uka',
        'mosque': 'ulo alakuba',
        'peace': 'udo',
        'water': 'mmiri',
        'food': 'nri',
        'rice': 'osikapa',
        'bread': 'achicha',
        'meat': 'anu',
        'fish': 'azu',
        'car': 'ugbo ala',
        'bus': 'ugbo ojii',
        'phone': 'ekwenti',
        'book': 'akwukwo',
        'pen': 'mkpisi',
        'big': 'ukwu',
        'small': 'obere',
        'hot': 'okpomoku',
        'cold': 'oyi',
        'fast': 'ngwa ngwa',
        'slow': 'nwayo nwayo',
        'happy': 'obi uto',
        'sad': 'mwute',
        'angry': 'iwe',
        'tired': 'ike gwuru',
        'hungry': 'aguu',
        'thirsty': 'akpiri kpo',
        'sick': 'oria',
        'fine': 'oma',
        'beautiful': 'mma',
        'ugly': 'joo',
        'new': 'ohuru',
        'old': 'ochie',
        'young': 'nwata',
        'man': 'nwoke',
        'woman': 'nwanyi',
        'boy': 'nwa nwoke',
        'girl': 'nwa nwanyi'
    },
    'igbo_to_english': {
        'ndewo': 'hello',
        'ka omesia': 'goodbye',
        'dalu': 'thank you',
        'biko': 'please',
        'ee': 'yes',
        'mba': 'no',
        'oma': 'good',
        'ojoo': 'bad',
        'kedu ka i mere': 'how are you',
        'olee': 'where',
        'mgbe': 'when',
        'gini mere': 'why',
        'gini': 'what',
        'onye': 'who',
        'kedu': 'how',
        'gaa': 'go',
        'bia': 'come',
        'kwusi': 'stop',
        'chere': 'wait',
        'nyere aka': 'help',
        'ndo': 'sorry',
        'cherem': 'excuse me',
        'nnoo': 'welcome',
        'enyi': 'friend',
        'ezina ulo': 'family',
        'nne': 'mother',
        'nna': 'father',
        'nwata': 'child',
        'ihunanya': 'love',
        'masiri': 'like',
        'choro': 'want',
        'kwesiri': 'need',
        'nwere': 'have',
        'nweta': 'get',
        'nye': 'give',
        'were': 'take',
        'hu': 'see',
        'lee': 'look',
        'nu': 'hear',
        'kwuo': 'speak',
        'rie': 'eat',
        'nuo': 'drink',
        'hie ura': 'sleep',
        'ruo oru': 'work',
        'gwuo egwu': 'play',
        'guo': 'read',
        'dee': 'write',
        'zuo': 'buy',
        'ree': 'sell',
        'ego': 'money',
        'oge': 'time',
        'ubochi': 'day',
        'abali': 'night',
        'ututo': 'morning',
        'ehihie': 'afternoon',
        'mgbede': 'evening',
        'taa': 'today',
        'echi': 'tomorrow',
        'nynyahu': 'yesterday',
        'ugbu a': 'now',
        'mgbe ozo': 'later',
        'ebe a': 'here',
        'ebe ahu': 'there',
        'ulo': 'home',
        'ulo akwukwo': 'school',
        'ulo ogwu': 'hospital',
        'ahia': 'market',
        'uka': 'church',
        'ulo alakuba': 'mosque',
        'udo': 'peace',
        'mmiri': 'water',
        'nri': 'food',
        'osikapa': 'rice',
        'achicha': 'bread',
        'anu': 'meat',
        'azu': 'fish',
        'ugbo ala': 'car',
        'ugbo ojii': 'bus',
        'ekwenti': 'phone',
        'akwukwo': 'book',
        'mkpisi': 'pen',
        'ukwu': 'big',
        'obere': 'small',
        'okpomoku': 'hot',
        'oyi': 'cold',
        'ngwa ngwa': 'fast',
        'nwayo nwayo': 'slow',
        'obi uto': 'happy',
        'mwute': 'sad',
        'iwe': 'angry',
        'ike gwuru': 'tired',
        'aguu': 'hungry',
        'akpiri kpo': 'thirsty',
        'oria': 'sick',
        'mma': 'beautiful',
        'joo': 'ugly',
        'ohuru': 'new',
        'ochie': 'old',
        'nwoke': 'man',
        'nwanyi': 'woman',
        'nwa nwoke': 'boy',
        'nwa nwanyi': 'girl'
    },
    
    // Swahili translations (Kenya, Tanzania, Uganda) - COMPREHENSIVE DICTIONARY
    'english_to_swahili': {
        'hello': 'hujambo',
        'hi': 'habari',
        'goodbye': 'kwaheri',
        'bye': 'tutaonana',
        'thank you': 'asante',
        'thanks': 'asante sana',
        'please': 'tafadhali',
        'yes': 'ndiyo',
        'no': 'hapana',
        'good': 'nzuri',
        'bad': 'mbaya',
        'how are you': 'habari yako',
        'where': 'wapi',
        'when': 'lini',
        'why': 'kwa nini',
        'what': 'nini',
        'who': 'nani',
        'how': 'vipi',
        'go': 'enda',
        'come': 'njoo',
        'stop': 'simama',
        'wait': 'ngoja',
        'help': 'msaada',
        'sorry': 'pole',
        'excuse me': 'samahani',
        'welcome': 'karibu',
        'friend': 'rafiki',
        'family': 'familia',
        'mother': 'mama',
        'father': 'baba',
        'child': 'mtoto',
        'love': 'upendo',
        'like': 'penda',
        'want': 'taka',
        'need': 'hitaji',
        'have': 'nina',
        'get': 'pata',
        'give': 'toa',
        'take': 'chukua',
        'see': 'ona',
        'look': 'angalia',
        'hear': 'sikia',
        'speak': 'sema',
        'eat': 'kula',
        'drink': 'kunywa',
        'sleep': 'lala',
        'work': 'kazi',
        'play': 'cheza',
        'read': 'soma',
        'write': 'andika',
        'buy': 'nunua',
        'sell': 'uza',
        'money': 'pesa',
        'time': 'wakati',
        'day': 'siku',
        'night': 'usiku',
        'morning': 'asubuhi',
        'afternoon': 'mchana',
        'evening': 'jioni',
        'today': 'leo',
        'tomorrow': 'kesho',
        'yesterday': 'jana',
        'now': 'sasa',
        'later': 'baadaye',
        'here': 'hapa',
        'there': 'pale',
        'home': 'nyumbani',
        'house': 'nyumba',
        'school': 'shule',
        'hospital': 'hospitali',
        'market': 'soko',
        'church': 'kanisa',
        'mosque': 'msikiti',
        'peace': 'amani',
        'water': 'maji',
        'food': 'chakula',
        'rice': 'wali',
        'bread': 'mkate',
        'meat': 'nyama',
        'fish': 'samaki',
        'car': 'gari',
        'bus': 'basi',
        'phone': 'simu',
        'book': 'kitabu',
        'pen': 'kalamu',
        'big': 'kubwa',
        'small': 'ndogo',
        'hot': 'moto',
        'cold': 'baridi',
        'fast': 'haraka',
        'slow': 'polepole',
        'happy': 'furaha',
        'sad': 'huzuni',
        'angry': 'hasira',
        'tired': 'uchovu',
        'hungry': 'njaa',
        'thirsty': 'kiu',
        'sick': 'mgonjwa',
        'fine': 'nzuri',
        'beautiful': 'mzuri',
        'ugly': 'mbaya',
        'new': 'mpya',
        'old': 'zamani',
        'young': 'kijana',
        'man': 'mwanaume',
        'woman': 'mwanamke',
        'boy': 'mvulana',
        'girl': 'msichana'
    },
    'swahili_to_english': {
        'hujambo': 'hello',
        'habari': 'hi',
        'kwaheri': 'goodbye',
        'tutaonana': 'bye',
        'asante': 'thank you',
        'asante sana': 'thanks',
        'tafadhali': 'please',
        'ndiyo': 'yes',
        'hapana': 'no',
        'nzuri': 'good',
        'mbaya': 'bad',
        'habari yako': 'how are you',
        'wapi': 'where',
        'lini': 'when',
        'kwa nini': 'why',
        'nini': 'what',
        'nani': 'who',
        'vipi': 'how',
        'enda': 'go',
        'njoo': 'come',
        'simama': 'stop',
        'ngoja': 'wait',
        'msaada': 'help',
        'pole': 'sorry',
        'samahani': 'excuse me',
        'karibu': 'welcome',
        'rafiki': 'friend',
        'familia': 'family',
        'mama': 'mother',
        'baba': 'father',
        'mtoto': 'child',
        'upendo': 'love',
        'penda': 'like',
        'taka': 'want',
        'hitaji': 'need',
        'nina': 'have',
        'pata': 'get',
        'toa': 'give',
        'chukua': 'take',
        'ona': 'see',
        'angalia': 'look',
        'sikia': 'hear',
        'sema': 'speak',
        'kula': 'eat',
        'kunywa': 'drink',
        'lala': 'sleep',
        'kazi': 'work',
        'cheza': 'play',
        'soma': 'read',
        'andika': 'write',
        'nunua': 'buy',
        'uza': 'sell',
        'pesa': 'money',
        'wakati': 'time',
        'siku': 'day',
        'usiku': 'night',
        'asubuhi': 'morning',
        'mchana': 'afternoon',
        'jioni': 'evening',
        'leo': 'today',
        'kesho': 'tomorrow',
        'jana': 'yesterday',
        'sasa': 'now',
        'baadaye': 'later',
        'hapa': 'here',
        'pale': 'there',
        'nyumbani': 'home',
        'nyumba': 'house',
        'shule': 'school',
        'hospitali': 'hospital',
        'soko': 'market',
        'kanisa': 'church',
        'msikiti': 'mosque',
        'amani': 'peace',
        'maji': 'water',
        'chakula': 'food',
        'wali': 'rice',
        'mkate': 'bread',
        'nyama': 'meat',
        'samaki': 'fish',
        'gari': 'car',
        'basi': 'bus',
        'simu': 'phone',
        'kitabu': 'book',
        'kalamu': 'pen',
        'kubwa': 'big',
        'ndogo': 'small',
        'moto': 'hot',
        'baridi': 'cold',
        'haraka': 'fast',
        'polepole': 'slow',
        'furaha': 'happy',
        'huzuni': 'sad',
        'hasira': 'angry',
        'uchovu': 'tired',
        'njaa': 'hungry',
        'kiu': 'thirsty',
        'mgonjwa': 'sick',
        'mzuri': 'beautiful',
        'mpya': 'new',
        'zamani': 'old',
        'kijana': 'young',
        'mwanaume': 'man',
        'mwanamke': 'woman',
        'mvulana': 'boy',
        'msichana': 'girl'
    },
    
    // Zulu translations (South Africa) - COMPREHENSIVE DICTIONARY
    'english_to_zulu': {
        'hello': 'sawubona',
        'hi': 'yebo',
        'goodbye': 'sala kahle',
        'bye': 'hamba kahle',
        'thank you': 'ngiyabonga',
        'thanks': 'siyabonga',
        'please': 'ngicela',
        'yes': 'yebo',
        'no': 'cha',
        'good': 'kuhle',
        'bad': 'kubi',
        'how are you': 'unjani',
        'where': 'kuphi',
        'when': 'nini',
        'why': 'kungani',
        'what': 'yini',
        'who': 'ubani',
        'how': 'kanjani',
        'go': 'hamba',
        'come': 'woza',
        'stop': 'yima',
        'wait': 'linda',
        'help': 'siza',
        'sorry': 'ngiyaxolisa',
        'excuse me': 'uxolo',
        'welcome': 'siyakwamukela',
        'friend': 'umngane',
        'family': 'umndeni',
        'mother': 'umama',
        'father': 'ubaba',
        'child': 'ingane',
        'love': 'uthando',
        'like': 'ngiyakuthanda',
        'want': 'ngifuna',
        'need': 'ngidinga',
        'have': 'nginayo',
        'get': 'thola',
        'give': 'nika',
        'take': 'thatha',
        'see': 'bona',
        'look': 'bheka',
        'hear': 'zwa',
        'speak': 'khuluma',
        'eat': 'dla',
        'drink': 'phuza',
        'sleep': 'lala',
        'work': 'sebenza',
        'play': 'dlala',
        'read': 'funda',
        'write': 'bhala',
        'buy': 'thenga',
        'sell': 'thengisa',
        'money': 'imali',
        'time': 'isikhathi',
        'day': 'usuku',
        'night': 'ubusuku',
        'morning': 'ekuseni',
        'afternoon': 'ntambama',
        'evening': 'kusihlwa',
        'today': 'namuhla',
        'tomorrow': 'kusasa',
        'yesterday': 'izolo',
        'now': 'manje',
        'later': 'kamuva',
        'here': 'lapha',
        'there': 'lapho',
        'home': 'ekhaya',
        'house': 'indlu',
        'school': 'isikole',
        'hospital': 'isibhedlela',
        'market': 'imakethe',
        'church': 'ibandla',
        'mosque': 'imosque',
        'peace': 'ukuthula',
        'water': 'amanzi',
        'food': 'ukudla',
        'rice': 'irayisi',
        'bread': 'isinkwa',
        'meat': 'inyama',
        'fish': 'inhlanzi',
        'car': 'imoto',
        'bus': 'ibhasi',
        'phone': 'ucingo',
        'book': 'incwadi',
        'pen': 'usiba',
        'big': 'khulu',
        'small': 'ncane',
        'hot': 'shisayo',
        'cold': 'bandayo',
        'fast': 'shesha',
        'slow': 'kancane',
        'happy': 'jabulile',
        'sad': 'dabukile',
        'angry': 'casula',
        'tired': 'khathele',
        'hungry': 'lambile',
        'thirsty': 'omile',
        'sick': 'gula',
        'fine': 'kulungile',
        'beautiful': 'muhle',
        'ugly': 'mubi',
        'new': 'sha',
        'old': 'dala',
        'young': 'sha',
        'man': 'indoda',
        'woman': 'owesifazane',
        'boy': 'umfana',
        'girl': 'intombazane'
    },
    'zulu_to_english': {
        'sawubona': 'hello',
        'yebo': 'yes',
        'sala kahle': 'goodbye',
        'hamba kahle': 'bye',
        'ngiyabonga': 'thank you',
        'siyabonga': 'thanks',
        'ngicela': 'please',
        'cha': 'no',
        'kuhle': 'good',
        'kubi': 'bad',
        'unjani': 'how are you',
        'kuphi': 'where',
        'nini': 'when',
        'kungani': 'why',
        'yini': 'what',
        'ubani': 'who',
        'kanjani': 'how',
        'hamba': 'go',
        'woza': 'come',
        'yima': 'stop',
        'linda': 'wait',
        'siza': 'help',
        'ngiyaxolisa': 'sorry',
        'uxolo': 'excuse me',
        'siyakwamukela': 'welcome',
        'umngane': 'friend',
        'umndeni': 'family',
        'umama': 'mother',
        'ubaba': 'father',
        'ingane': 'child',
        'uthando': 'love',
        'ngiyakuthanda': 'like',
        'ngifuna': 'want',
        'ngidinga': 'need',
        'nginayo': 'have',
        'thola': 'get',
        'nika': 'give',
        'thatha': 'take',
        'bona': 'see',
        'bheka': 'look',
        'zwa': 'hear',
        'khuluma': 'speak',
        'dla': 'eat',
        'phuza': 'drink',
        'lala': 'sleep',
        'sebenza': 'work',
        'dlala': 'play',
        'funda': 'read',
        'bhala': 'write',
        'thenga': 'buy',
        'thengisa': 'sell',
        'imali': 'money',
        'isikhathi': 'time',
        'usuku': 'day',
        'ubusuku': 'night',
        'ekuseni': 'morning',
        'ntambama': 'afternoon',
        'kusihlwa': 'evening',
        'namuhla': 'today',
        'kusasa': 'tomorrow',
        'izolo': 'yesterday',
        'manje': 'now',
        'kamuva': 'later',
        'lapha': 'here',
        'lapho': 'there',
        'ekhaya': 'home',
        'indlu': 'house',
        'isikole': 'school',
        'isibhedlela': 'hospital',
        'imakethe': 'market',
        'ibandla': 'church',
        'imosque': 'mosque',
        'ukuthula': 'peace',
        'amanzi': 'water',
        'ukudla': 'food',
        'irayisi': 'rice',
        'isinkwa': 'bread',
        'inyama': 'meat',
        'inhlanzi': 'fish',
        'imoto': 'car',
        'ibhasi': 'bus',
        'ucingo': 'phone',
        'incwadi': 'book',
        'usiba': 'pen',
        'khulu': 'big',
        'ncane': 'small',
        'shisayo': 'hot',
        'bandayo': 'cold',
        'shesha': 'fast',
        'kancane': 'slow',
        'jabulile': 'happy',
        'dabukile': 'sad',
        'casula': 'angry',
        'khathele': 'tired',
        'lambile': 'hungry',
        'omile': 'thirsty',
        'gula': 'sick',
        'kulungile': 'fine',
        'muhle': 'beautiful',
        'mubi': 'ugly',
        'sha': 'new',
        'dala': 'old',
        'indoda': 'man',
        'owesifazane': 'woman',
        'umfana': 'boy',
        'intombazane': 'girl'
    }
};

// Translation endpoint
router.post('/', async (req, res) => {
    try {
        const { text, from, to } = req.body;

        if (!text || !from || !to) {
            return res.status(400).json({
                error: 'Missing required fields: text, from, to'
            });
        }

        // Check custom translations first (exact matches)
        const customKey = `${from}_to_${to}`;
        if (CUSTOM_TRANSLATIONS[customKey]) {
            const customTranslation = CUSTOM_TRANSLATIONS[customKey][text.toLowerCase()];
            if (customTranslation) {
                return res.json({
                    translatedText: customTranslation,
                    sourceLanguage: from,
                    targetLanguage: to,
                    confidence: 0.95,
                    method: 'custom_dictionary'
                });
            }
        }
        
        // Try enhanced translation functions for English pairs
        if (from === 'english') {
            const enhancedTranslation = translateFromEnglish(text, to);
            if (enhancedTranslation !== text) {
                return res.json({
                    translatedText: enhancedTranslation,
                    sourceLanguage: from,
                    targetLanguage: to,
                    confidence: 0.85,
                    method: 'enhanced_dictionary'
                });
            }
        }
        
        if (to === 'english') {
            const enhancedTranslation = translateToEnglish(text, from);
            if (enhancedTranslation !== text) {
                return res.json({
                    translatedText: enhancedTranslation,
                    sourceLanguage: from,
                    targetLanguage: to,
                    confidence: 0.85,
                    method: 'enhanced_dictionary'
                });
            }
        }

        // Try multiple translation services
        let translatedText = text;
        let confidence = 0.5;
        let method = 'fallback';
        
        try {
            // Try Google Translate API (if available)
            if (process.env.GOOGLE_TRANSLATE_API_KEY) {
                const googleResponse = await translateWithGoogle(text, from, to);
                if (googleResponse) {
                    translatedText = googleResponse.text;
                    confidence = googleResponse.confidence || 0.8;
                    method = 'google_translate';
                }
            }
        } catch (error) {
            // Silently fall back to custom translation
        }

        // If no translation service available, provide basic word-by-word translation
        if (method === 'fallback') {
            translatedText = await basicTranslation(text, from, to);
            confidence = translatedText !== text ? 0.8 : 0.3; // Higher confidence if translation occurred
        }

        res.json({
            translatedText,
            sourceLanguage: from,
            targetLanguage: to,
            confidence,
            method,
            originalText: text
        });

    } catch (error) {
        console.error('Translation error:', error);
        res.status(500).json({
            error: 'Translation failed',
            message: error.message
        });
    }
});

// Basic word-by-word translation using custom dictionary
async function basicTranslation(text, from, to) {
    const words = text.toLowerCase().split(' ');
    const customKey = `${from}_to_${to}`;
    
    // If translating to/from English, provide basic translations
    if (to === 'english') {
        return translateToEnglish(text, from);
    }
    
    if (from === 'english') {
        return translateFromEnglish(text, to);
    }
    
    if (!CUSTOM_TRANSLATIONS[customKey]) {
        // Try reverse translation if direct translation not available
        const reverseKey = `${to}_to_${from}`;
        if (CUSTOM_TRANSLATIONS[reverseKey]) {
            // Find reverse matches
            const reverseDict = CUSTOM_TRANSLATIONS[reverseKey];
            const translatedWords = words.map(word => {
                // Find the key that has this word as value
                for (const [key, value] of Object.entries(reverseDict)) {
                    if (value === word) {
                        return key;
                    }
                }
                return word;
            });
            return translatedWords.join(' ');
        }
        return text; // Return original if no translation available
    }

    const translatedWords = words.map(word => {
        return CUSTOM_TRANSLATIONS[customKey][word] || word;
    });

    return translatedWords.join(' ');
}

// Translate to English from African languages
function translateToEnglish(text, from) {
    // Use the main CUSTOM_TRANSLATIONS dictionary
    const translationKey = `${from}_to_english`;
    const dict = CUSTOM_TRANSLATIONS[translationKey];
    
    if (!dict) {
        // Fallback to original method for languages not in main dictionary
        const englishTranslations = {
            'twi': {
                'akwaaba': 'welcome',
                'medaase': 'thank you',
                'aane': 'yes',
                'daabi': 'no',
                'wo ho te sen': 'how are you',
                'ɛyɛ': 'good',
                'mepaakyɛw': 'please',
                'nante yiye': 'goodbye'
            },
            'yoruba': {
                'kaabo': 'welcome',
                'e se': 'thank you',
                'beni': 'yes',
                'rara': 'no',
                'bawo ni': 'how are you',
                'o dara': 'good',
                'je ka lo': 'please',
                'o dabo': 'goodbye'
            },
            'hausa': {
                'sannu': 'hello',
                'na gode': 'thank you',
                'eh': 'yes',
                'a\'a': 'no',
                'yaya kake': 'how are you',
                'yana da kyau': 'good',
                'don allah': 'please',
                'sai an jima': 'goodbye'
            },
            'igbo': {
                'ndewo': 'hello',
                'dalu': 'thank you',
                'ee': 'yes',
                'mba': 'no',
                'kedu ka i mere': 'how are you',
                'o di mma': 'good',
                'biko': 'please',
                'ka o di': 'goodbye'
            }
        };
        
        const fallbackDict = englishTranslations[from] || {};
        const words = text.toLowerCase().split(' ');
        
        const translatedWords = words.map(word => {
            return fallbackDict[word] || word;
        });
        
        return translatedWords.join(' ');
    }
    
    const lowerText = text.toLowerCase();
    
    // Check for exact phrase matches first
    for (const [original, translation] of Object.entries(dict)) {
        if (lowerText.includes(original)) {
            return lowerText.replace(original, translation);
        }
    }
    
    // Word by word translation
    const words = lowerText.split(' ');
    const translatedWords = words.map(word => {
        return dict[word] || word;
    });
    
    return translatedWords.join(' ');
}

// Translate from English to African languages
function translateFromEnglish(text, to) {
    // Use the main CUSTOM_TRANSLATIONS dictionary
    const translationKey = `english_to_${to}`;
    const dict = CUSTOM_TRANSLATIONS[translationKey];
    
    if (!dict) {
        // Fallback to original method for languages not in main dictionary
        const fromEnglishTranslations = {
            'twi': {
                'welcome': 'akwaaba',
                'hello': 'akwaaba',
                'thank you': 'medaase',
                'yes': 'aane',
                'no': 'daabi',
                'how are you': 'wo ho te sen',
                'good': 'ɛyɛ',
                'please': 'mepaakyɛw',
                'goodbye': 'nante yiye'
            },
            'yoruba': {
                'welcome': 'kaabo',
                'hello': 'kaabo',
                'thank you': 'e se',
                'yes': 'beni',
                'no': 'rara',
                'how are you': 'bawo ni',
                'good': 'o dara',
                'please': 'je ka lo',
                'goodbye': 'o dabo'
            },
            'hausa': {
                'welcome': 'sannu',
                'hello': 'sannu',
                'thank you': 'na gode',
                'yes': 'eh',
                'no': 'a\'a',
                'how are you': 'yaya kake',
                'good': 'yana da kyau',
                'please': 'don allah',
                'goodbye': 'sai an jima'
            },
            'igbo': {
                'welcome': 'ndewo',
                'hello': 'ndewo',
                'thank you': 'dalu',
                'yes': 'ee',
                'no': 'mba',
                'how are you': 'kedu ka i mere',
                'good': 'o di mma',
                'please': 'biko',
                'goodbye': 'ka o di'
            }
        };
        
        const fallbackDict = fromEnglishTranslations[to] || {};
        const lowerText = text.toLowerCase();
        
        // Check for exact phrase matches first
        for (const [english, translation] of Object.entries(fallbackDict)) {
            if (lowerText.includes(english)) {
                return lowerText.replace(english, translation);
            }
        }
        
        // Word by word translation
        const words = lowerText.split(' ');
        const translatedWords = words.map(word => {
            return fallbackDict[word] || word;
        });
        
        return translatedWords.join(' ');
    }
    
    const lowerText = text.toLowerCase();
    
    // Check for exact phrase matches first (longest phrases first)
    const sortedPhrases = Object.entries(dict).sort((a, b) => b[0].length - a[0].length);
    for (const [english, translation] of sortedPhrases) {
        if (lowerText.includes(english)) {
            return lowerText.replace(new RegExp(english, 'gi'), translation);
        }
    }
    
    // Word by word translation
    const words = lowerText.split(' ');
    const translatedWords = words.map(word => {
        return dict[word] || word;
    });
    
    return translatedWords.join(' ');
}

// Google Translate integration (if API key is provided)
async function translateWithGoogle(text, from, to) {
    if (!process.env.GOOGLE_TRANSLATE_API_KEY) {
        return null;
    }

    try {
        const response = await axios.post(
            `https://translation.googleapis.com/language/translate/v2?key=${process.env.GOOGLE_TRANSLATE_API_KEY}`,
            {
                q: text,
                source: LANGUAGE_CODES[from] || from,
                target: LANGUAGE_CODES[to] || to,
                format: 'text'
            }
        );

        return {
            text: response.data.data.translations[0].translatedText,
            confidence: 0.9
        };
    } catch (error) {
        console.error('Google Translate error:', error);
        return null;
    }
}

// Language detection endpoint
router.post('/detect', async (req, res) => {
    try {
        const { text } = req.body;

        if (!text) {
            return res.status(400).json({
                error: 'Text is required for language detection'
            });
        }

        // Simple language detection based on common words
        const detectedLanguage = detectLanguage(text);

        res.json({
            detectedLanguage,
            confidence: 0.7,
            text
        });

    } catch (error) {
        console.error('Language detection error:', error);
        res.status(500).json({
            error: 'Language detection failed',
            message: error.message
        });
    }
});

// Simple language detection
function detectLanguage(text) {
    const lowerText = text.toLowerCase();
    
    // Twi/Akan detection
    const twiWords = ['akwaaba', 'medaase', 'aane', 'daabi', 'ɛyɛ', 'wo ho te sen'];
    if (twiWords.some(word => lowerText.includes(word))) {
        return 'twi';
    }
    
    // Yoruba detection
    const yorubaWords = ['kaabo', 'e se', 'beni', 'rara', 'bawo ni', 'o dara'];
    if (yorubaWords.some(word => lowerText.includes(word))) {
        return 'yoruba';
    }
    
    // Hausa detection
    const hausaWords = ['sannu', 'na gode', 'eh', 'a\'a', 'yaya kake'];
    if (hausaWords.some(word => lowerText.includes(word))) {
        return 'hausa';
    }
    
    // Igbo detection
    const igboWords = ['ndewo', 'dalu', 'ee', 'mba', 'kedu ka i mere'];
    if (igboWords.some(word => lowerText.includes(word))) {
        return 'igbo';
    }
    
    // Default to English
    return 'english';
}

module.exports = router;
